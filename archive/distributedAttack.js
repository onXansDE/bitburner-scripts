export async function main(ns) {
    ns.disableLog("ALL");
    const cpu_core_weight = 1;
    const ram_weight = 1.5;
    if (ns.args.length <= 5) {
        ns.tprintRaw("Usage: run distributedAttack.js <victimAttackMode> <victimGroups> <attackMode> <attackGroups> <script> <targetServers...>");
        ns.tprintRaw("victimAttackMode: even, max, min, random");
        ns.tprintRaw("victimGroups: number of groups to split the target servers into");
        ns.tprintRaw("attackMode: even, random, memory, cores, coreAndMemory");
        ns.tprintRaw("attackGroups: number of groups to split the attacker servers into");
        ns.tprintRaw("script: script to run on the attacker servers");
        return;
    }
    var victimAttackMode = String(ns.args[0]);
    var victimGroups = Number(ns.args[1]);
    var attackMode = String(ns.args[2]);
    var attackGroups = Number(ns.args[3]);
    var script = String(ns.args[4]);
    var scriptMemory = ns.getScriptRam(script);
    if (victimAttackMode === "undefined")
        victimAttackMode = "even";
    if (victimGroups === 0)
        victimGroups = 1;
    var targetServers = splitTargetServers(ns.args.slice(5).map((s) => ns.getServer(String(s))), victimGroups, victimAttackMode);
    ns.exec("clearAllServers.js", "home", 1, script);
    const args = ns.args.slice(5).map((s) => String(s));
    ns.exec("distributeOnAllServers.js", "home", 1, script);
    ns.tail();
    ns.print(`Splitting targets ${targetServers.length} servers into ${victimGroups} groups using ${victimAttackMode} method:`);
    for (var i = 0; i < targetServers.length; i++) {
        for (var j = 0; j < targetServers[i].length; j++) {
            printTargetServer(targetServers[i][j]);
        }
        ns.print(" ");
    }
    await ns.sleep(5000);
    ns.print(" ");
    var attackServers = getRootServers(getAllServers());
    var attackServerGroups = splitAttackServers(attackServers, attackGroups, attackMode);
    ns.print(`Splitting ${attackServers.length} attackers into ${attackGroups} groups using ${attackMode} method:`);
    for (var i = 0; i < attackServerGroups.length; i++) {
        for (var j = 0; j < attackServerGroups[i].length; j++) {
            printAttackerServer(attackServerGroups[i][j]);
        }
        ns.print(" ");
    }
    ns.print(" ");
    ns.print("Starting attack");
    await ns.sleep(5000);
    for (var i = 0; i < attackGroups; i++) {
        attackGroup(attackServerGroups[i], targetServers[i % victimGroups]);
    }
    await ns.sleep(5000);
    // Add this logging before the attack loop
    ns.print(`targetServers: ${JSON.stringify(targetServers)}`);
    ns.print(`victimGroups: ${victimGroups}`);
    ns.print(`attackServerGroups: ${JSON.stringify(attackServerGroups)}`);
    ns.print(`attackGroups: ${attackGroups}`);
    // Add this logging before the attack loop
    ns.print(`Starting attack with ${attackGroups} attack groups and ${victimGroups} victim groups`);
    for (var i = 0; i < attackGroups; i++) {
        if (!attackServerGroups[i] || !targetServers[i % victimGroups]) {
            ns.print(`Skipping attack group ${i} due to undefined target or attacker group`);
            continue;
        }
        attackGroup(attackServerGroups[i], targetServers[i % victimGroups]);
    }
    function calulateMaxThreads(server) {
        return Math.floor(server.maxRam / scriptMemory);
    }
    function attackGroup(attackerGroup, targetGroup) {
        for (var i = 0; i < attackerGroup.length; i++) {
            attackServer(attackerGroup[i], targetGroup[i % targetGroup.length]);
        }
    }
    function attackServer(attacker, target) {
        ns.print(`Attacking ${attacker.hostname} -> ${target.hostname}`);
        ns.killall(attacker.hostname);
        ns.exec(script, attacker.hostname, calulateMaxThreads(attacker), target.hostname);
    }
    function getAllServers(server = "home", visited = new Set()) {
        visited.add(server);
        const servers = ns.scan(server).filter((s) => !visited.has(s));
        for (const s of servers) {
            getAllServers(s, visited);
        }
        return Array.from(visited)
            .filter((s) => s !== "home")
            .map((s) => ns.getServer(s));
    }
    function getRootServers(servers) {
        return servers.filter((server) => server.hasAdminRights);
    }
    function splitTargetServers(servers, groups, method) {
        switch (method) {
            case "even":
                return splitEven(servers, groups);
            case "max":
                return splitMax(servers, groups);
            case "min":
                return splitMin(servers, groups);
            case "random":
                return splitRandom(servers, groups);
            default:
                return [];
        }
    }
    function splitAttackServers(servers, groups, method) {
        switch (method) {
            case "even":
                return splitEven(servers, groups);
            case "random":
                return splitRandom(servers, groups);
            case "memory":
                return splitMemory(servers, groups);
            case "cores":
                return splitCores(servers, groups);
            case "coreAndMemory":
                return splitCoreAndMemory(servers, groups);
            default:
                return [];
        }
    }
    function splitRandom(servers, groups) {
        const groupsArray = Array.from({ length: groups }, () => []);
        for (const server of servers) {
            const randomIndex = Math.floor(Math.random() * groups);
            groupsArray[randomIndex].push(server);
        }
        return groupsArray;
    }
    function splitEven(servers, groups) {
        const groupSize = Math.floor(servers.length / groups);
        let remainder = servers.length % groups;
        const groupsArray = [];
        let startIndex = 0;
        for (let i = 0; i < groups; i++) {
            const endIndex = startIndex + groupSize + (remainder > 0 ? 1 : 0);
            groupsArray.push(servers.slice(startIndex, endIndex)); // Pushes a subarray into groupsArray
            startIndex = endIndex;
            remainder--;
        }
        return groupsArray; // Returns an array of arrays
    }
    function splitMax(servers, groups) {
        const sortedServers = servers.sort(sortByMaxMoney);
        return splitEven(sortedServers, groups);
    }
    function splitMin(servers, groups) {
        const sortedServers = servers.sort(sortByMinSecurity);
        return splitEven(sortedServers, groups);
    }
    function splitMemory(servers, groups) {
        const sortedServers = servers.sort(sortByMaxMemory);
        return splitEven(sortedServers, groups);
    }
    function splitCores(servers, groups) {
        const sortedServers = servers.sort(sortByCoreCount);
        return splitEven(sortedServers, groups);
    }
    function splitCoreAndMemory(servers, groups) {
        const sortedServers = servers.sort(sortByCoreAndMemory);
        return splitEven(sortedServers, groups);
    }
    function sortByMaxMoney(a, b) {
        return b.moneyMax - a.moneyMax;
    }
    function sortByMinSecurity(a, b) {
        return b.minDifficulty - a.minDifficulty;
    }
    function sortByMaxMemory(a, b) {
        return b.maxRam - a.maxRam;
    }
    function sortByCoreCount(a, b) {
        return b.cpuCores - a.cpuCores;
    }
    function sortByCoreAndMemory(a, b) {
        return (b.cpuCores * cpu_core_weight +
            b.maxRam * ram_weight -
            (a.cpuCores * cpu_core_weight + a.maxRam * ram_weight));
    }
    function printTargetServer(server) {
        const moneyFormatted = formatMoney(server.moneyMax);
        const serverName = server.hostname;
        const isAdmin = server.hasAdminRights;
        const skillRequirement = server.requiredHackingSkill;
        // [admin ? x/checkmark] - serverName - $max: moneyFormated - skill: skillRequirement
        ns.print(`[${isAdmin ? "x" : " "}] - ${serverName} - $max: ${moneyFormatted} - skill: ${skillRequirement}`);
    }
    function printAttackerServer(server) {
        const serverName = server.hostname;
        const memory = server.maxRam;
        const cpu = server.cpuCores;
        // [admin ? x/checkmark] - serverName - $max: moneyFormated - skill: skillRequirement
        ns.print(`${serverName} - $MEM: ${memory} - cores: ${cpu}`);
    }
    function formatMoney(money) {
        if (money >= 1e12) {
            return (money / 1e12).toFixed(4) + " T";
        }
        else if (money >= 1e9) {
            return (money / 1e9).toFixed(4) + " B";
        }
        else if (money >= 1e6) {
            return (money / 1e6).toFixed(4) + " M";
        }
        else if (money >= 1e3) {
            return (money / 1e3).toFixed(4) + " k";
        }
        else {
            return money.toFixed(4);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzdHJpYnV0ZWRBdHRhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkaXN0cmlidXRlZEF0dGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLENBQUMsS0FBSyxVQUFVLElBQUksQ0FBQyxFQUFNO0lBQ2hDLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFckIsTUFBTSxlQUFlLEdBQUcsQ0FBQyxDQUFDO0lBQzFCLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQztJQUV2QixJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtRQUN4QixFQUFFLENBQUMsU0FBUyxDQUNYLDJIQUEySCxDQUMzSCxDQUFDO1FBQ0YsRUFBRSxDQUFDLFNBQVMsQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1FBQ3pELEVBQUUsQ0FBQyxTQUFTLENBQ1gsaUVBQWlFLENBQ2pFLENBQUM7UUFDRixFQUFFLENBQUMsU0FBUyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7UUFDdkUsRUFBRSxDQUFDLFNBQVMsQ0FDWCxtRUFBbUUsQ0FDbkUsQ0FBQztRQUNGLEVBQUUsQ0FBQyxTQUFTLENBQUMsK0NBQStDLENBQUMsQ0FBQztRQUU5RCxPQUFPO0tBQ1A7SUFFRCxJQUFJLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUMsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0QyxJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEMsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFD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Q0FBQyxDQUFDLENBQUM7U0FDeEI7SUFDRixDQUFDO0FBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5TLCBTZXJ2ZXIgfSBmcm9tIFwiQG5zXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFpbihuczogTlMpOiBQcm9taXNlPHZvaWQ+IHtcclxuXHRucy5kaXNhYmxlTG9nKFwiQUxMXCIpO1xyXG5cclxuXHRjb25zdCBjcHVfY29yZV93ZWlnaHQgPSAxO1xyXG5cdGNvbnN0IHJhbV93ZWlnaHQgPSAxLjU7XHJcblxyXG5cdGlmIChucy5hcmdzLmxlbmd0aCA8PSA1KSB7XHJcblx0XHRucy50cHJpbnRSYXcoXHJcblx0XHRcdFwiVXNhZ2U6IHJ1biBkaXN0cmlidXRlZEF0dGFjay5qcyA8dmljdGltQXR0YWNrTW9kZT4gPHZpY3RpbUdyb3Vwcz4gPGF0dGFja01vZGU+IDxhdHRhY2tHcm91cHM+IDxzY3JpcHQ+IDx0YXJnZXRTZXJ2ZXJzLi4uPlwiXHJcblx0XHQpO1xyXG5cdFx0bnMudHByaW50UmF3KFwidmljdGltQXR0YWNrTW9kZTogZXZlbiwgbWF4LCBtaW4sIHJhbmRvbVwiKTtcclxuXHRcdG5zLnRwcmludFJhdyhcclxuXHRcdFx0XCJ2aWN0aW1Hcm91cHM6IG51bWJlciBvZiBncm91cHMgdG8gc3BsaXQgdGhlIHRhcmdldCBzZXJ2ZXJzIGludG9cIlxyXG5cdFx0KTtcclxuXHRcdG5zLnRwcmludFJhdyhcImF0dGFja01vZGU6IGV2ZW4sIHJhbmRvbSwgbWVtb3J5LCBjb3JlcywgY29yZUFuZE1lbW9yeVwiKTtcclxuXHRcdG5zLnRwcmludFJhdyhcclxuXHRcdFx0XCJhdHRhY2tHcm91cHM6IG51bWJlciBvZiBncm91cHMgdG8gc3BsaXQgdGhlIGF0dGFja2VyIHNlcnZlcnMgaW50b1wiXHJcblx0XHQpO1xyXG5cdFx0bnMudHByaW50UmF3KFwic2NyaXB0OiBzY3JpcHQgdG8gcnVuIG9uIHRoZSBhdHRhY2tlciBzZXJ2ZXJzXCIpO1xyXG5cclxuXHRcdHJldHVybjtcclxuXHR9XHJcblxyXG5cdHZhciB2aWN0aW1BdHRhY2tNb2RlID0gU3RyaW5nKG5zLmFyZ3NbMF0pO1xyXG5cdHZhciB2aWN0aW1Hcm91cHMgPSBOdW1iZXIobnMuYXJnc1sxXSk7XHJcblx0dmFyIGF0dGFja01vZGUgPSBTdHJpbmcobnMuYXJnc1syXSk7XHJcblx0dmFyIGF0dGFja0dyb3VwcyA9IE51bWJlcihucy5hcmdzWzNdKTtcclxuXHR2YXIgc2NyaXB0ID0gU3RyaW5nKG5zLmFyZ3NbNF0pO1xyXG5cclxuXHR2YXIgc2NyaXB0TWVtb3J5ID0gbnMuZ2V0U2NyaXB0UmFtKHNjcmlwdCk7XHJcblxyXG5cdGlmICh2aWN0aW1BdHRhY2tNb2RlID09PSBcInVuZGVmaW5lZFwiKSB2aWN0aW1BdHRhY2tNb2RlID0gXCJldmVuXCI7XHJcblxyXG5cdGlmICh2aWN0aW1Hcm91cHMgPT09IDApIHZpY3RpbUdyb3VwcyA9IDE7XHJcblxyXG5cdHZhciB0YXJnZXRTZXJ2ZXJzID0gc3BsaXRUYXJnZXRTZXJ2ZXJzKFxyXG5cdFx0bnMuYXJncy5zbGljZSg1KS5tYXAoKHMpID0+IG5zLmdldFNlcnZlcihTdHJpbmcocykpKSxcclxuXHRcdHZpY3RpbUdyb3VwcyxcclxuXHRcdHZpY3RpbUF0dGFja01vZGVcclxuXHQpO1xyXG5cclxuXHRucy5leGVjKFwiY2xlYXJBbGxTZXJ2ZXJzLmpzXCIsIFwiaG9tZVwiLCAxLCBzY3JpcHQpO1xyXG5cdGNvbnN0IGFyZ3MgPSBucy5hcmdzLnNsaWNlKDUpLm1hcCgocykgPT4gU3RyaW5nKHMpKTtcclxuXHRucy5leGVjKFwiZGlzdHJpYnV0ZU9uQWxsU2VydmVycy5qc1wiLCBcImhvbWVcIiwgMSwgc2NyaXB0KTtcclxuXHJcblx0bnMudGFpbCgpO1xyXG5cclxuXHRucy5wcmludChcclxuXHRcdGBTcGxpdHRpbmcgdGFyZ2V0cyAke3RhcmdldFNlcnZlcnMubGVuZ3RofSBzZXJ2ZXJzIGludG8gJHt2aWN0aW1Hcm91cHN9IGdyb3VwcyB1c2luZyAke3ZpY3RpbUF0dGFja01vZGV9IG1ldGhvZDpgXHJcblx0KTtcclxuXHJcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0YXJnZXRTZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHRhcmdldFNlcnZlcnNbaV0ubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0cHJpbnRUYXJnZXRTZXJ2ZXIodGFyZ2V0U2VydmVyc1tpXVtqXSk7XHJcblx0XHR9XHJcblx0XHRucy5wcmludChcIiBcIik7XHJcblx0fVxyXG5cdGF3YWl0IG5zLnNsZWVwKDUwMDApO1xyXG5cclxuXHRucy5wcmludChcIiBcIik7XHJcblxyXG5cdHZhciBhdHRhY2tTZXJ2ZXJzID0gZ2V0Um9vdFNlcnZlcnMoZ2V0QWxsU2VydmVycygpKTtcclxuXHJcblx0dmFyIGF0dGFja1NlcnZlckdyb3VwcyA9IHNwbGl0QXR0YWNrU2VydmVycyhcclxuXHRcdGF0dGFja1NlcnZlcnMsXHJcblx0XHRhdHRhY2tHcm91cHMsXHJcblx0XHRhdHRhY2tNb2RlXHJcblx0KTtcclxuXHJcblx0bnMucHJpbnQoXHJcblx0XHRgU3BsaXR0aW5nICR7YXR0YWNrU2VydmVycy5sZW5ndGh9IGF0dGFja2VycyBpbnRvICR7YXR0YWNrR3JvdXBzfSBncm91cHMgdXNpbmcgJHthdHRhY2tNb2RlfSBtZXRob2Q6YFxyXG5cdCk7XHJcblxyXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgYXR0YWNrU2VydmVyR3JvdXBzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGF0dGFja1NlcnZlckdyb3Vwc1tpXS5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRwcmludEF0dGFja2VyU2VydmVyKGF0dGFja1NlcnZlckdyb3Vwc1tpXVtqXSk7XHJcblx0XHR9XHJcblx0XHRucy5wcmludChcIiBcIik7XHJcblx0fVxyXG5cclxuXHRucy5wcmludChcIiBcIik7XHJcblx0bnMucHJpbnQoXCJTdGFydGluZyBhdHRhY2tcIik7XHJcblxyXG5cdGF3YWl0IG5zLnNsZWVwKDUwMDApO1xyXG5cclxuXHRmb3IgKHZhciBpID0gMDsgaSA8IGF0dGFja0dyb3VwczsgaSsrKSB7XHJcblx0XHRhdHRhY2tHcm91cChhdHRhY2tTZXJ2ZXJHcm91cHNbaV0sIHRhcmdldFNlcnZlcnNbaSAlIHZpY3RpbUdyb3Vwc10pO1xyXG5cdH1cclxuXHJcblx0YXdhaXQgbnMuc2xlZXAoNTAwMCk7XHJcblxyXG5cdC8vIEFkZCB0aGlzIGxvZ2dpbmcgYmVmb3JlIHRoZSBhdHRhY2sgbG9vcFxyXG5cdG5zLnByaW50KGB0YXJnZXRTZXJ2ZXJzOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldFNlcnZlcnMpfWApO1xyXG5cdG5zLnByaW50KGB2aWN0aW1Hcm91cHM6ICR7dmljdGltR3JvdXBzfWApO1xyXG5cdG5zLnByaW50KGBhdHRhY2tTZXJ2ZXJHcm91cHM6ICR7SlNPTi5zdHJpbmdpZnkoYXR0YWNrU2VydmVyR3JvdXBzKX1gKTtcclxuXHRucy5wcmludChgYXR0YWNrR3JvdXBzOiAke2F0dGFja0dyb3Vwc31gKTtcclxuXHJcblx0Ly8gQWRkIHRoaXMgbG9nZ2luZyBiZWZvcmUgdGhlIGF0dGFjayBsb29wXHJcblx0bnMucHJpbnQoXHJcblx0XHRgU3RhcnRpbmcgYXR0YWNrIHdpdGggJHthdHRhY2tHcm91cHN9IGF0dGFjayBncm91cHMgYW5kICR7dmljdGltR3JvdXBzfSB2aWN0aW0gZ3JvdXBzYFxyXG5cdCk7XHJcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhdHRhY2tHcm91cHM7IGkrKykge1xyXG5cdFx0aWYgKCFhdHRhY2tTZXJ2ZXJHcm91cHNbaV0gfHwgIXRhcmdldFNlcnZlcnNbaSAlIHZpY3RpbUdyb3Vwc10pIHtcclxuXHRcdFx0bnMucHJpbnQoXHJcblx0XHRcdFx0YFNraXBwaW5nIGF0dGFjayBncm91cCAke2l9IGR1ZSB0byB1bmRlZmluZWQgdGFyZ2V0IG9yIGF0dGFja2VyIGdyb3VwYFxyXG5cdFx0XHQpO1xyXG5cdFx0XHRjb250aW51ZTtcclxuXHRcdH1cclxuXHRcdGF0dGFja0dyb3VwKGF0dGFja1NlcnZlckdyb3Vwc1tpXSwgdGFyZ2V0U2VydmVyc1tpICUgdmljdGltR3JvdXBzXSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjYWx1bGF0ZU1heFRocmVhZHMoc2VydmVyOiBTZXJ2ZXIpOiBudW1iZXIge1xyXG5cdFx0cmV0dXJuIE1hdGguZmxvb3Ioc2VydmVyLm1heFJhbSAvIHNjcmlwdE1lbW9yeSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBhdHRhY2tHcm91cChhdHRhY2tlckdyb3VwOiBTZXJ2ZXJbXSwgdGFyZ2V0R3JvdXA6IFNlcnZlcltdKTogdm9pZCB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGF0dGFja2VyR3JvdXAubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0YXR0YWNrU2VydmVyKGF0dGFja2VyR3JvdXBbaV0sIHRhcmdldEdyb3VwW2kgJSB0YXJnZXRHcm91cC5sZW5ndGhdKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGF0dGFja1NlcnZlcihhdHRhY2tlcjogU2VydmVyLCB0YXJnZXQ6IFNlcnZlcik6IHZvaWQge1xyXG5cdFx0bnMucHJpbnQoYEF0dGFja2luZyAke2F0dGFja2VyLmhvc3RuYW1lfSAtPiAke3RhcmdldC5ob3N0bmFtZX1gKTtcclxuXHRcdG5zLmtpbGxhbGwoYXR0YWNrZXIuaG9zdG5hbWUpO1xyXG5cdFx0bnMuZXhlYyhcclxuXHRcdFx0c2NyaXB0LFxyXG5cdFx0XHRhdHRhY2tlci5ob3N0bmFtZSxcclxuXHRcdFx0Y2FsdWxhdGVNYXhUaHJlYWRzKGF0dGFja2VyKSxcclxuXHRcdFx0dGFyZ2V0Lmhvc3RuYW1lXHJcblx0XHQpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZ2V0QWxsU2VydmVycyhcclxuXHRcdHNlcnZlcjogc3RyaW5nID0gXCJob21lXCIsXHJcblx0XHR2aXNpdGVkOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKVxyXG5cdCk6IFNlcnZlcltdIHtcclxuXHRcdHZpc2l0ZWQuYWRkKHNlcnZlcik7XHJcblx0XHRjb25zdCBzZXJ2ZXJzID0gbnMuc2NhbihzZXJ2ZXIpLmZpbHRlcigocykgPT4gIXZpc2l0ZWQuaGFzKHMpKTtcclxuXHRcdGZvciAoY29uc3QgcyBvZiBzZXJ2ZXJzKSB7XHJcblx0XHRcdGdldEFsbFNlcnZlcnMocywgdmlzaXRlZCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gQXJyYXkuZnJvbSh2aXNpdGVkKVxyXG5cdFx0XHQuZmlsdGVyKChzKSA9PiBzICE9PSBcImhvbWVcIilcclxuXHRcdFx0Lm1hcCgocykgPT4gbnMuZ2V0U2VydmVyKHMpKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGdldFJvb3RTZXJ2ZXJzKHNlcnZlcnM6IFNlcnZlcltdKTogU2VydmVyW10ge1xyXG5cdFx0cmV0dXJuIHNlcnZlcnMuZmlsdGVyKChzZXJ2ZXIpID0+IHNlcnZlci5oYXNBZG1pblJpZ2h0cyk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzcGxpdFRhcmdldFNlcnZlcnMoXHJcblx0XHRzZXJ2ZXJzOiBTZXJ2ZXJbXSxcclxuXHRcdGdyb3VwczogbnVtYmVyLFxyXG5cdFx0bWV0aG9kOiBzdHJpbmdcclxuXHQpOiBTZXJ2ZXJbXVtdIHtcclxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XHJcblx0XHRcdGNhc2UgXCJldmVuXCI6XHJcblx0XHRcdFx0cmV0dXJuIHNwbGl0RXZlbihzZXJ2ZXJzLCBncm91cHMpO1xyXG5cdFx0XHRjYXNlIFwibWF4XCI6XHJcblx0XHRcdFx0cmV0dXJuIHNwbGl0TWF4KHNlcnZlcnMsIGdyb3Vwcyk7XHJcblx0XHRcdGNhc2UgXCJtaW5cIjpcclxuXHRcdFx0XHRyZXR1cm4gc3BsaXRNaW4oc2VydmVycywgZ3JvdXBzKTtcclxuXHRcdFx0Y2FzZSBcInJhbmRvbVwiOlxyXG5cdFx0XHRcdHJldHVybiBzcGxpdFJhbmRvbShzZXJ2ZXJzLCBncm91cHMpO1xyXG5cdFx0XHRkZWZhdWx0OlxyXG5cdFx0XHRcdHJldHVybiBbXTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHNwbGl0QXR0YWNrU2VydmVycyhcclxuXHRcdHNlcnZlcnM6IFNlcnZlcltdLFxyXG5cdFx0Z3JvdXBzOiBudW1iZXIsXHJcblx0XHRtZXRob2Q6IHN0cmluZ1xyXG5cdCk6IFNlcnZlcltdW10ge1xyXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcclxuXHRcdFx0Y2FzZSBcImV2ZW5cIjpcclxuXHRcdFx0XHRyZXR1cm4gc3BsaXRFdmVuKHNlcnZlcnMsIGdyb3Vwcyk7XHJcblx0XHRcdGNhc2UgXCJyYW5kb21cIjpcclxuXHRcdFx0XHRyZXR1cm4gc3BsaXRSYW5kb20oc2VydmVycywgZ3JvdXBzKTtcclxuXHRcdFx0Y2FzZSBcIm1lbW9yeVwiOlxyXG5cdFx0XHRcdHJldHVybiBzcGxpdE1lbW9yeShzZXJ2ZXJzLCBncm91cHMpO1xyXG5cdFx0XHRjYXNlIFwiY29yZXNcIjpcclxuXHRcdFx0XHRyZXR1cm4gc3BsaXRDb3JlcyhzZXJ2ZXJzLCBncm91cHMpO1xyXG5cdFx0XHRjYXNlIFwiY29yZUFuZE1lbW9yeVwiOlxyXG5cdFx0XHRcdHJldHVybiBzcGxpdENvcmVBbmRNZW1vcnkoc2VydmVycywgZ3JvdXBzKTtcclxuXHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHRyZXR1cm4gW107XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzcGxpdFJhbmRvbShzZXJ2ZXJzOiBTZXJ2ZXJbXSwgZ3JvdXBzOiBudW1iZXIpOiBTZXJ2ZXJbXVtdIHtcclxuXHRcdGNvbnN0IGdyb3Vwc0FycmF5OiBTZXJ2ZXJbXVtdID0gQXJyYXkuZnJvbShcclxuXHRcdFx0eyBsZW5ndGg6IGdyb3VwcyB9LFxyXG5cdFx0XHQoKSA9PiBbXVxyXG5cdFx0KTtcclxuXHRcdGZvciAoY29uc3Qgc2VydmVyIG9mIHNlcnZlcnMpIHtcclxuXHRcdFx0Y29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBncm91cHMpO1xyXG5cdFx0XHRncm91cHNBcnJheVtyYW5kb21JbmRleF0ucHVzaChzZXJ2ZXIpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGdyb3Vwc0FycmF5O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc3BsaXRFdmVuKHNlcnZlcnM6IFNlcnZlcltdLCBncm91cHM6IG51bWJlcik6IFNlcnZlcltdW10ge1xyXG5cdFx0Y29uc3QgZ3JvdXBTaXplID0gTWF0aC5mbG9vcihzZXJ2ZXJzLmxlbmd0aCAvIGdyb3Vwcyk7XHJcblx0XHRsZXQgcmVtYWluZGVyID0gc2VydmVycy5sZW5ndGggJSBncm91cHM7XHJcblxyXG5cdFx0Y29uc3QgZ3JvdXBzQXJyYXk6IFNlcnZlcltdW10gPSBbXTtcclxuXHRcdGxldCBzdGFydEluZGV4ID0gMDtcclxuXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGdyb3VwczsgaSsrKSB7XHJcblx0XHRcdGNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIGdyb3VwU2l6ZSArIChyZW1haW5kZXIgPiAwID8gMSA6IDApO1xyXG5cdFx0XHRncm91cHNBcnJheS5wdXNoKHNlcnZlcnMuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXgpKTsgLy8gUHVzaGVzIGEgc3ViYXJyYXkgaW50byBncm91cHNBcnJheVxyXG5cdFx0XHRzdGFydEluZGV4ID0gZW5kSW5kZXg7XHJcblx0XHRcdHJlbWFpbmRlci0tO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBncm91cHNBcnJheTsgLy8gUmV0dXJucyBhbiBhcnJheSBvZiBhcnJheXNcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHNwbGl0TWF4KHNlcnZlcnM6IFNlcnZlcltdLCBncm91cHM6IG51bWJlcik6IFNlcnZlcltdW10ge1xyXG5cdFx0Y29uc3Qgc29ydGVkU2VydmVycyA9IHNlcnZlcnMuc29ydChzb3J0QnlNYXhNb25leSk7XHJcblx0XHRyZXR1cm4gc3BsaXRFdmVuKHNvcnRlZFNlcnZlcnMsIGdyb3Vwcyk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzcGxpdE1pbihzZXJ2ZXJzOiBTZXJ2ZXJbXSwgZ3JvdXBzOiBudW1iZXIpOiBTZXJ2ZXJbXVtdIHtcclxuXHRcdGNvbnN0IHNvcnRlZFNlcnZlcnMgPSBzZXJ2ZXJzLnNvcnQoc29ydEJ5TWluU2VjdXJpdHkpO1xyXG5cdFx0cmV0dXJuIHNwbGl0RXZlbihzb3J0ZWRTZXJ2ZXJzLCBncm91cHMpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc3BsaXRNZW1vcnkoc2VydmVyczogU2VydmVyW10sIGdyb3VwczogbnVtYmVyKTogU2VydmVyW11bXSB7XHJcblx0XHRjb25zdCBzb3J0ZWRTZXJ2ZXJzID0gc2VydmVycy5zb3J0KHNvcnRCeU1heE1lbW9yeSk7XHJcblx0XHRyZXR1cm4gc3BsaXRFdmVuKHNvcnRlZFNlcnZlcnMsIGdyb3Vwcyk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzcGxpdENvcmVzKHNlcnZlcnM6IFNlcnZlcltdLCBncm91cHM6IG51bWJlcik6IFNlcnZlcltdW10ge1xyXG5cdFx0Y29uc3Qgc29ydGVkU2VydmVycyA9IHNlcnZlcnMuc29ydChzb3J0QnlDb3JlQ291bnQpO1xyXG5cdFx0cmV0dXJuIHNwbGl0RXZlbihzb3J0ZWRTZXJ2ZXJzLCBncm91cHMpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc3BsaXRDb3JlQW5kTWVtb3J5KHNlcnZlcnM6IFNlcnZlcltdLCBncm91cHM6IG51bWJlcik6IFNlcnZlcltdW10ge1xyXG5cdFx0Y29uc3Qgc29ydGVkU2VydmVycyA9IHNlcnZlcnMuc29ydChzb3J0QnlDb3JlQW5kTWVtb3J5KTtcclxuXHRcdHJldHVybiBzcGxpdEV2ZW4oc29ydGVkU2VydmVycywgZ3JvdXBzKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHNvcnRCeU1heE1vbmV5KGE6IFNlcnZlciwgYjogU2VydmVyKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiBiLm1vbmV5TWF4ISAtIGEubW9uZXlNYXghO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc29ydEJ5TWluU2VjdXJpdHkoYTogU2VydmVyLCBiOiBTZXJ2ZXIpOiBudW1iZXIge1xyXG5cdFx0cmV0dXJuIGIubWluRGlmZmljdWx0eSEgLSBhLm1pbkRpZmZpY3VsdHkhO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc29ydEJ5TWF4TWVtb3J5KGE6IFNlcnZlciwgYjogU2VydmVyKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiBiLm1heFJhbSEgLSBhLm1heFJhbSE7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzb3J0QnlDb3JlQ291bnQoYTogU2VydmVyLCBiOiBTZXJ2ZXIpOiBudW1iZXIge1xyXG5cdFx0cmV0dXJuIGIuY3B1Q29yZXMhIC0gYS5jcHVDb3JlcyE7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzb3J0QnlDb3JlQW5kTWVtb3J5KGE6IFNlcnZlciwgYjogU2VydmVyKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiAoXHJcblx0XHRcdGIuY3B1Q29yZXMhICogY3B1X2NvcmVfd2VpZ2h0ICtcclxuXHRcdFx0Yi5tYXhSYW0hICogcmFtX3dlaWdodCAtXHJcblx0XHRcdChhLmNwdUNvcmVzISAqIGNwdV9jb3JlX3dlaWdodCArIGEubWF4UmFtISAqIHJhbV93ZWlnaHQpXHJcblx0XHQpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcHJpbnRUYXJnZXRTZXJ2ZXIoc2VydmVyOiBTZXJ2ZXIpOiB2b2lkIHtcclxuXHRcdGNvbnN0IG1vbmV5Rm9ybWF0dGVkID0gZm9ybWF0TW9uZXkoc2VydmVyLm1vbmV5TWF4ISk7XHJcblx0XHRjb25zdCBzZXJ2ZXJOYW1lID0gc2VydmVyLmhvc3RuYW1lO1xyXG5cdFx0Y29uc3QgaXNBZG1pbiA9IHNlcnZlci5oYXNBZG1pblJpZ2h0cztcclxuXHRcdGNvbnN0IHNraWxsUmVxdWlyZW1lbnQgPSBzZXJ2ZXIucmVxdWlyZWRIYWNraW5nU2tpbGw7XHJcblxyXG5cdFx0Ly8gW2FkbWluID8geC9jaGVja21hcmtdIC0gc2VydmVyTmFtZSAtICRtYXg6IG1vbmV5Rm9ybWF0ZWQgLSBza2lsbDogc2tpbGxSZXF1aXJlbWVudFxyXG5cdFx0bnMucHJpbnQoXHJcblx0XHRcdGBbJHtcclxuXHRcdFx0XHRpc0FkbWluID8gXCJ4XCIgOiBcIiBcIlxyXG5cdFx0XHR9XSAtICR7c2VydmVyTmFtZX0gLSAkbWF4OiAke21vbmV5Rm9ybWF0dGVkfSAtIHNraWxsOiAke3NraWxsUmVxdWlyZW1lbnR9YFxyXG5cdFx0KTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHByaW50QXR0YWNrZXJTZXJ2ZXIoc2VydmVyOiBTZXJ2ZXIpOiB2b2lkIHtcclxuXHRcdGNvbnN0IHNlcnZlck5hbWUgPSBzZXJ2ZXIuaG9zdG5hbWU7XHJcblx0XHRjb25zdCBtZW1vcnkgPSBzZXJ2ZXIubWF4UmFtO1xyXG5cdFx0Y29uc3QgY3B1ID0gc2VydmVyLmNwdUNvcmVzO1xyXG5cdFx0Ly8gW2FkbWluID8geC9jaGVja21hcmtdIC0gc2VydmVyTmFtZSAtICRtYXg6IG1vbmV5Rm9ybWF0ZWQgLSBza2lsbDogc2tpbGxSZXF1aXJlbWVudFxyXG5cdFx0bnMucHJpbnQoYCR7c2VydmVyTmFtZX0gLSAkTUVNOiAke21lbW9yeX0gLSBjb3JlczogJHtjcHV9YCk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBmb3JtYXRNb25leShtb25leTogbnVtYmVyKTogc3RyaW5nIHtcclxuXHRcdGlmIChtb25leSA+PSAxZTEyKSB7XHJcblx0XHRcdHJldHVybiAobW9uZXkgLyAxZTEyKS50b0ZpeGVkKDQpICsgXCIgVFwiO1xyXG5cdFx0fSBlbHNlIGlmIChtb25leSA+PSAxZTkpIHtcclxuXHRcdFx0cmV0dXJuIChtb25leSAvIDFlOSkudG9GaXhlZCg0KSArIFwiIEJcIjtcclxuXHRcdH0gZWxzZSBpZiAobW9uZXkgPj0gMWU2KSB7XHJcblx0XHRcdHJldHVybiAobW9uZXkgLyAxZTYpLnRvRml4ZWQoNCkgKyBcIiBNXCI7XHJcblx0XHR9IGVsc2UgaWYgKG1vbmV5ID49IDFlMykge1xyXG5cdFx0XHRyZXR1cm4gKG1vbmV5IC8gMWUzKS50b0ZpeGVkKDQpICsgXCIga1wiO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuIG1vbmV5LnRvRml4ZWQoNCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcbiJdfQ==